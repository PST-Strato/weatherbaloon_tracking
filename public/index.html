<!DOCTYPE html>
<html>

<head>
  <title>Weather balloon tracking</title>
  <meta charset="utf-8" />
  <link href="https://fonts.googleapis.com/css?family=Roboto:100,300,400,500,700,900" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/@mdi/font@4.x/css/materialdesignicons.min.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/vuetify@2.x/dist/vuetify.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="//unpkg.com/leaflet/dist/leaflet.css" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, minimal-ui" />
</head>

<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
<script src="//unpkg.com/leaflet/dist/leaflet.js"></script>
<script src="//unpkg.com/vue2-leaflet"></script>
<script src="./components/map.js"></script>
<script src="./components/graph.js"></script>
<script src="./components/weather.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.1/Chart.min.js"></script>
<script src="https://unpkg.com/vue-chartjs/dist/vue-chartjs.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
<script src="https://cdn.jsdelivr.net/npm/vuetify@2.x/dist/vuetify.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>



<div id="app" class="app">
  <v-app>
    <v-container fluid class="grow ma-5 pa-5 d-flex flex-wrap justify-center">
      <v-col cols="8">
        <v-card elevation="20" class="fill-height">
          <tracking-map :coordinates="this.locations"></tracking-map>
        </v-card>
      </v-col>
      <v-col cols="4">
        <v-row>
          <weather-card :weather_data="this.weatherData"></weather-card>
        </v-row>
        <v-row>
          <v-card elevation="20" class="fill-height mt-4 justify-center">
            <line-chart :temp="this.allTempData" :time="this.TimeData2" id="lc" width="500px"></line-chart>
          </v-card>
          <!--<v-card elevation="20" class="fill-height mt-4 justify-center">
              <v-card-title class="text-center justify-center py-6">
                <h3 class="text-h5">
                  Data Chart
                </h3>
              </v-card-title>
           
              <v-tabs v-model="subscribe" background-color="transparent" grow height="30px">
                <v-tab href="#data1">
                  <h5>Data1</h5>
                </v-tab>
                <v-tab href="#data2">
                  <h5>Data2</h5>
                </v-tab>
                <v-tab href="#data3">
                  <h5>Data3</h5>
                </v-tab>
              </v-tabs>
              <v-tabs-items v-model="subscribe">
                <v-tab-item value="data1">
                  <v-card>
                  <line-chart :tpdata="allTempData" :tmdata="TimeData2" id="lc" width="500px"></line-chart>
                  </v-card flat>
                </v-tab-item>
                <v-tab-item :key="2" value="data2">
                  <v-card>
                    <line-chart id="lc2" width="500px"></line-chart>
                  </v-card flat>
                </v-tab-item>
                <v-tab-item :key="3" value="data3">
                  <v-card flat>
                    <line-chart id="lc3" width="500px"></line-chart>
                  </v-card>
                </v-tab-item>
              </v-tabs-items>
            
            </v-card>-->

          <!--<graph-card :v_model="this.tab"></graph-card>-->
        </v-row>
      </v-col>

    </v-container>

  </v-app>

</div>


<script>
  
  var trsbien = Vue.component("line-chart", {
      props: ['temp','time'],
      extends: VueChartJs.Line,
      options: {
        responsive: true,
        maintainAspectRatio: false
      },
  
      mounted() {
        this.gradient = this.$refs.canvas.getContext('2d').createLinearGradient(0, 0, 0, 100000)
        this.gradient2 = this.$refs.canvas.getContext('2d').createLinearGradient(0, 0, 0, 100000)
  
        this.gradient2.addColorStop(0, 'rgba(83,154,168, 0.9)')
        this.gradient2.addColorStop(0.5, 'rgba(83,154,168, 0.5)');
        this.gradient2.addColorStop(1, 'rgba(83,154,168, 0.2)');
  
        this.gradient.addColorStop(0, 'rgba(247,108,6, 0.9)')
        this.gradient.addColorStop(0.5, 'rgba(247,108,6, 0.25)');
        this.gradient.addColorStop(1, 'rgba(247,108,6, 0)');

        this.renderChart(
        
        
        
        {
          labels: this.time,
          datasets: [
            {
              label: 'TempÃ©rature',
              borderColor: '#FC2525',
              pointBackgroundColor: 'white',
              borderWidth: 1,
              pointBorderColor: 'white',
              backgroundColor: this.gradient,
              data: this.temp
            },
          ]
  
        }, this.options)
  
      }
  
    })

  new Vue({
    el: "#app",
    vuetify: new Vuetify(),
    data: {
      message: "Hello, world",
      locations: [[48.08809362529545, -0.7564902305603027]],
      weatherData: [],
      allTempData: [],
      TimeData2: [],
      tab: "subscribe",
    },
    methods: {
      getLocations: function () {
        var tmp = [];
        axios.get("/api/locations/getlastlocation").then((response) => {
          this.tmp = response["data"];
          this.locations.push(this.tmp);
        });
      },
      getWeatherData: function () {
        axios.get("/api/weather/getweatherdata").then((response) => {
          this.weatherData = [];
          this.weatherData = response["data"];
          //console.log(this.weatherData.temperature_inside)

        });
      },
      get10LastTemp: function () {
        axios.get("/api/weather/getemperatureinside").then((response) => {
          temp = []
          this.allTempData = response["data"];
          for (var i = 0; i < this.allTempData.length; i++) {
            this.allTempData.splice(i, 1, parseInt(this.allTempData[i]))
          }
          //this.allTempData2 = this.allTempData2.slice(Math.max(this.allTempData2.length - 5, 40));
          console.log(this.allTempData)
        });
      },
      get10LastTime: function () {
        axios.get("/api/weather/getime").then((response) => {
          this.TimeData2 = response["data"];
          //this.TimeData2 = this.TimeData2.slice(Math.max(this.TimeData2.length - 5, 40));
          console.log(Object.values(this.TimeData2))
        });
      },
    },
    created: function () {
      this.getLocations();
      this.getWeatherData();
      this.get10LastTemp();
      this.get10LastTime();
    },

    components: {
      "tracking-map": trackingMap,
      "weather-card": weatherCard,
      "graph-card": graphCard,
      "line-chart": trsbien
    },

  });


</script>
</body>

</html>